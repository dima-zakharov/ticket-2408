id: ssrf-localhost-protection

info:
  name: SSRF Localhost Protection Test
  author: security-team
  severity: info
  description: Test suite for localhost SSRF protection (TC-SSRF-005 to TC-SSRF-006)
  tags: ssrf,security,localhost

variables:
  token: "{{TOKEN}}"

requests:
  # TC-SSRF-005: Localhost Blocked
  
  - name: localhost-127-0-0-1
    method: POST
    path:
      - "{{BaseURL}}/api/resources/fetch"
    headers:
      Authorization: "Bearer {{token}}"
      Content-Type: "application/json"
    body: '{"url":"http://127.0.0.1:8000/admin"}'
    matchers:
      - type: status
        status:
          - 400
          - 403
        part: header

  - name: localhost-hostname
    method: POST
    path:
      - "{{BaseURL}}/api/resources/fetch"
    headers:
      Authorization: "Bearer {{token}}"
      Content-Type: "application/json"
    body: '{"url":"http://localhost:3000/"}'
    matchers:
      - type: status
        status:
          - 400
          - 403
        part: header

  - name: localhost-127-0-0-2
    method: POST
    path:
      - "{{BaseURL}}/api/resources/fetch"
    headers:
      Authorization: "Bearer {{token}}"
      Content-Type: "application/json"
    body: '{"url":"http://127.0.0.2/"}'
    matchers:
      - type: status
        status:
          - 400
          - 403
        part: header

  - name: localhost-127-1-1-1
    method: POST
    path:
      - "{{BaseURL}}/api/resources/fetch"
    headers:
      Authorization: "Bearer {{token}}"
      Content-Type: "application/json"
    body: '{"url":"http://127.1.1.1/"}'
    matchers:
      - type: status
        status:
          - 400
          - 403
        part: header

  - name: localhost-0-0-0-0
    method: POST
    path:
      - "{{BaseURL}}/api/resources/fetch"
    headers:
      Authorization: "Bearer {{token}}"
      Content-Type: "application/json"
    body: '{"url":"http://0.0.0.0:8080/"}'
    matchers:
      - type: status
        status:
          - 400
          - 403
        part: header

  - name: localhost-255-255-255-255
    method: POST
    path:
      - "{{BaseURL}}/api/resources/fetch"
    headers:
      Authorization: "Bearer {{token}}"
      Content-Type: "application/json"
    body: '{"url":"http://255.255.255.255/"}'
    matchers:
      - type: status
        status:
          - 400
          - 403
        part: header

  # TC-SSRF-006: IPv6 Localhost Blocked
  
  - name: localhost-ipv6-short
    method: POST
    path:
      - "{{BaseURL}}/api/resources/fetch"
    headers:
      Authorization: "Bearer {{token}}"
      Content-Type: "application/json"
    body: '{"url":"http://[::1]:8000/"}'
    matchers:
      - type: status
        status:
          - 400
          - 403
        part: header

  - name: localhost-ipv6-long
    method: POST
    path:
      - "{{BaseURL}}/api/resources/fetch"
    headers:
      Authorization: "Bearer {{token}}"
      Content-Type: "application/json"
    body: '{"url":"http://[0:0:0:0:0:0:0:1]/"}'
    matchers:
      - type: status
        status:
          - 400
          - 403
        part: header

  - name: localhost-ipv6-mapped-ipv4
    method: POST
    path:
      - "{{BaseURL}}/api/resources/fetch"
    headers:
      Authorization: "Bearer {{token}}"
      Content-Type: "application/json"
    body: '{"url":"http://[::ffff:127.0.0.1]/"}'
    matchers:
      - type: status
        status:
          - 400
          - 403
        part: header

  - name: localhost-ipv6-any
    method: POST
    path:
      - "{{BaseURL}}/api/resources/fetch"
    headers:
      Authorization: "Bearer {{token}}"
      Content-Type: "application/json"
    body: '{"url":"http://[::]/"}'
    matchers:
      - type: status
        status:
          - 400
          - 403
        part: header
