id: ssrf-url-parsing-bypass

info:
  name: SSRF URL Parsing Bypass Protection Test
  author: security-team
  severity: info
  description: Test suite for URL parsing bypass SSRF protection (TC-SSRF-008)
  tags: ssrf,security,bypass

variables:
  token: "{{TOKEN}}"

requests:
  # TC-SSRF-008: URL Parsing Bypass Attempts
  
  # URL with credentials (@ symbol)
  - name: bypass-url-credentials
    method: POST
    path:
      - "{{BaseURL}}/api/resources/fetch"
    headers:
      Authorization: "Bearer {{token}}"
      Content-Type: "application/json"
    body: '{"url":"http://evil.com@169.254.169.254/"}'
    matchers:
      - type: status
        status:
          - 400
          - 403
        part: header

  - name: bypass-url-credentials-localhost
    method: POST
    path:
      - "{{BaseURL}}/api/resources/fetch"
    headers:
      Authorization: "Bearer {{token}}"
      Content-Type: "application/json"
    body: '{"url":"http://example.com@127.0.0.1/"}'
    matchers:
      - type: status
        status:
          - 400
          - 403
        part: header

  # URL with fragment before host
  - name: bypass-url-fragment-host
    method: POST
    path:
      - "{{BaseURL}}/api/resources/fetch"
    headers:
      Authorization: "Bearer {{token}}"
      Content-Type: "application/json"
    body: '{"url":"http://example.com#@169.254.169.254/"}'
    matchers:
      - type: status
        status:
          - 400
          - 403
        part: header

  # Decimal IP representation
  - name: bypass-decimal-ip-metadata
    method: POST
    path:
      - "{{BaseURL}}/api/resources/fetch"
    headers:
      Authorization: "Bearer {{token}}"
      Content-Type: "application/json"
    body: '{"url":"http://2852039166/"}'
    matchers:
      - type: status
        status:
          - 400
          - 403
        part: header
    # 2852039166 = 169.254.169.254

  - name: bypass-decimal-ip-localhost
    method: POST
    path:
      - "{{BaseURL}}/api/resources/fetch"
    headers:
      Authorization: "Bearer {{token}}"
      Content-Type: "application/json"
    body: '{"url":"http://2130706433/"}'
    matchers:
      - type: status
        status:
          - 400
          - 403
        part: header
    # 2130706433 = 127.0.0.1

  # Octal IP representation
  - name: bypass-octal-ip-metadata
    method: POST
    path:
      - "{{BaseURL}}/api/resources/fetch"
    headers:
      Authorization: "Bearer {{token}}"
      Content-Type: "application/json"
    body: '{"url":"http://0251.0376.0251.0376/"}'
    matchers:
      - type: status
        status:
          - 400
          - 403
        part: header

  - name: bypass-octal-ip-localhost
    method: POST
    path:
      - "{{BaseURL}}/api/resources/fetch"
    headers:
      Authorization: "Bearer {{token}}"
      Content-Type: "application/json"
    body: '{"url":"http://0177.0.0.1/"}'
    matchers:
      - type: status
        status:
          - 400
          - 403
        part: header

  # Hex IP representation
  - name: bypass-hex-ip-metadata
    method: POST
    path:
      - "{{BaseURL}}/api/resources/fetch"
    headers:
      Authorization: "Bearer {{token}}"
      Content-Type: "application/json"
    body: '{"url":"http://0xa9fea9fe/"}'
    matchers:
      - type: status
        status:
          - 400
          - 403
        part: header

  - name: bypass-hex-ip-localhost
    method: POST
    path:
      - "{{BaseURL}}/api/resources/fetch"
    headers:
      Authorization: "Bearer {{token}}"
      Content-Type: "application/json"
    body: '{"url":"http://0x7f000001/"}'
    matchers:
      - type: status
        status:
          - 400
          - 403
        part: header

  # Mixed format IPs
  - name: bypass-mixed-ip-1
    method: POST
    path:
      - "{{BaseURL}}/api/resources/fetch"
    headers:
      Authorization: "Bearer {{token}}"
      Content-Type: "application/json"
    body: '{"url":"http://169.0xa9.0251.254/"}'
    matchers:
      - type: status
        status:
          - 400
          - 403
        part: header

  # URL encoding bypass
  - name: bypass-url-encoded-localhost
    method: POST
    path:
      - "{{BaseURL}}/api/resources/fetch"
    headers:
      Authorization: "Bearer {{token}}"
      Content-Type: "application/json"
    body: '{"url":"http://127%2E0%2E0%2E1/"}'
    matchers:
      - type: status
        status:
          - 400
          - 403
        part: header

  - name: bypass-double-url-encoded
    method: POST
    path:
      - "{{BaseURL}}/api/resources/fetch"
    headers:
      Authorization: "Bearer {{token}}"
      Content-Type: "application/json"
    body: '{"url":"http://127%252E0%252E0%252E1/"}'
    matchers:
      - type: status
        status:
          - 400
          - 403
        part: header

  # Unicode/UTF-8 encoding
  - name: bypass-unicode-localhost
    method: POST
    path:
      - "{{BaseURL}}/api/resources/fetch"
    headers:
      Authorization: "Bearer {{token}}"
      Content-Type: "application/json"
    body: '{"url":"http://127。0。0。1/"}'
    matchers:
      - type: status
        status:
          - 400
          - 403
        part: header

  # IPv4-mapped IPv6
  - name: bypass-ipv4-mapped-ipv6
    method: POST
    path:
      - "{{BaseURL}}/api/resources/fetch"
    headers:
      Authorization: "Bearer {{token}}"
      Content-Type: "application/json"
    body: '{"url":"http://[::ffff:7f00:0001]/"}'
    matchers:
      - type: status
        status:
          - 400
          - 403
        part: header

  # Wildcard hostname
  - name: bypass-wildcard-localhost
    method: POST
    path:
      - "{{BaseURL}}/api/resources/fetch"
    headers:
      Authorization: "Bearer {{token}}"
      Content-Type: "application/json"
    body: '{"url":"http://localhost./"}'
    matchers:
      - type: status
        status:
          - 400
          - 403
        part: header

  # Redirect via meta refresh (if HTML is parsed)
  - name: bypass-dots-before-host
    method: POST
    path:
      - "{{BaseURL}}/api/resources/fetch"
    headers:
      Authorization: "Bearer {{token}}"
      Content-Type: "application/json"
    body: '{"url":"http://....::1/"}'
    matchers:
      - type: status
        status:
          - 400
          - 403
        part: header
