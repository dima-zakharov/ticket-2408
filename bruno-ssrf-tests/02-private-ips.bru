meta {
  name: TC-SSRF-004 Private IP Ranges Blocked
  method: POST
  seq: 2
}

docs {
  """
  Test Case: TC-SSRF-004
  Objective: Verify private IP ranges are blocked
  
  Tests: 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16
  Expected: 400 or 403 response
  """
}

get {
  url: {{base_url}}/resources/
  req {
    headers {
      Authorization: Bearer {{token}}
      Content-Type: application/json
    }
    body {
      json {
        resource {
          uri: http://10.0.0.1/admin
          name: test-private-10-range
          content: test
        }
      }
    }
  }

  res {
    status: in [400, 403]
  }

  assert {
    res.status in [400, 403]
    res.body ~ /SSRF|blocked|not allowed|private|internal/i
  }
}

---

meta {
  name: TC-SSRF-004 Private IP 172.16 Range
  method: POST
  seq: 3
}

get {
  url: {{base_url}}/resources/
  req {
    headers {
      Authorization: Bearer {{token}}
      Content-Type: application/json
    }
    body {
      json {
        resource {
          uri: http://172.16.0.1/internal
          name: test-private-172-range
          content: test
        }
      }
    }
  }

  res {
    status: in [400, 403]
  }

  assert {
    res.status in [400, 403]
    res.body ~ /SSRF|blocked|not allowed|private|internal/i
  }
}

---

meta {
  name: TC-SSRF-004 Private IP 192.168 Range
  method: POST
  seq: 4
}

get {
  url: {{base_url}}/resources/
  req {
    headers {
      Authorization: Bearer {{token}}
      Content-Type: application/json
    }
    body {
      json {
        resource {
          uri: http://192.168.1.1/
          name: test-private-192-range
          content: test
        }
      }
    }
  }

  res {
    status: in [400, 403]
  }

  assert {
    res.status in [400, 403]
    res.body ~ /SSRF|blocked|not allowed|private|internal/i
  }
}
