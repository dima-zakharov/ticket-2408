meta {
  name: TC-SSRF-005 Localhost Blocked
  method: POST
  seq: 5
}

docs {
  """
  Test Case: TC-SSRF-005
  Objective: Verify localhost access is blocked
  
  Tests: 127.0.0.1, localhost hostname, 0.0.0.0
  Expected: 400 or 403 response
  """
}

get {
  url: {{base_url}}/resources/
  req {
    headers {
      Authorization: Bearer {{token}}
      Content-Type: application/json
    }
    body {
      json {
        resource {
          uri: http://127.0.0.1:8000/admin
          name: test-localhost-127
          content: test
        }
      }
    }
  }

  res {
    status: in [400, 403]
  }

  assert {
    res.status in [400, 403]
    res.body ~ /SSRF|blocked|not allowed|private|internal/i
  }
}

---

meta {
  name: TC-SSRF-005 Localhost Hostname
  method: POST
  seq: 6
}

get {
  url: {{base_url}}/resources/
  req {
    headers {
      Authorization: Bearer {{token}}
      Content-Type: application/json
    }
    body {
      json {
        resource {
          uri: http://localhost:3000/
          name: test-localhost-hostname
          content: test
        }
      }
    }
  }

  res {
    status: in [400, 403]
  }

  assert {
    res.status in [400, 403]
    res.body ~ /SSRF|blocked|not allowed|private|internal/i
  }
}

---

meta {
  name: TC-SSRF-005 Localhost 0.0.0.0
  method: POST
  seq: 7
}

get {
  url: {{base_url}}/resources/
  req {
    headers {
      Authorization: Bearer {{token}}
      Content-Type: application/json
    }
    body {
      json {
        resource {
          uri: http://0.0.0.0:8080/
          name: test-localhost-0000
          content: test
        }
      }
    }
  }

  res {
    status: in [400, 403]
  }

  assert {
    res.status in [400, 403]
    res.body ~ /SSRF|blocked|not allowed|private|internal/i
  }
}
